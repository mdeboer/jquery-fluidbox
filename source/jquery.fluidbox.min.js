(function(b){b(function(){var a=b.fluidbox={_currentCollection:{},_currentIndex:null,_currentOptions:{},_instance:{},_isLoading:!1,_isOpening:!1,_isClosing:!1,_isAnimated:!1,_isDraggable:!1,_hasModernizr:!1,_hasHammer:!1,_overlay:{},_viewport:{},_outer:{},_inner:{},_loading:{},_title:{},_animClasses:"animated flash bounce shake tada swing wobble wiggle pulse flip flipInX flipOutX flipInY flipOutY fadeIn fadeInUp fadeInDown fadeInLeft fadeInRight fadeInUpBig fadeInDownBig fadeInLeftBig fadeInRightBig fadeOut fadeOutUp fadeOutDown fadeOutLeft fadeOutRight fadeOutUpBig fadeOutDownBig fadeOutLeftBig fadeOutRightBig bounceIn bounceInDown bounceInUp bounceInLeft bounceInRight bounceOut bounceOutDown bounceOutUp bounceOutLeft bounceOutRight rotateIn rotateInDownLeft rotateInDownRight rotateInUpLeft rotateInUpRight rotateOut rotateOutDownLeft rotateOutDownRight rotateOutUpLeft rotateOutUpRight lightSpeedIn lightSpeedOut hinge rollIn rollOut",
_transEndEventNames:"webkitAnimationEnd animationend oanimationend MSAnimationEnd",defaults:{resize:!0,preload:!0,touch:!0,animated:!0,padding:50,templates:{inner:'<div id="fluidbox-inner"></div>',outer:'<div id="fluidbox-outer"></div>',overlay:'<div id="fluidbox-overlay"></div>',loading:'<div id="fluidbox-loading"></div>',title:'<div id="fluidbox-title"></div>',buttons:{close:'<div id="fluidbox-btn-close"></div>',next:'<div id="fluidbox-btn-next"></div>',prev:'<div id="fluidbox-btn-prev"></div>'}},
positions:{buttons:{close:"outer",next:"inner",prev:"inner"},title:"inner"},keys:{next:[39,40],prev:[37,38],close:[27]},animations:{open:"fadeIn",close:"fadeOut",next:{"in":"fadeInRight",out:"fadeOutLeft"},prev:{"in":"fadeInLeft",out:"fadeOutRight"}}},_createOverlay:function(){b(a._instance).triggerHandler("fluidboxBeforeCreate");0===b("#fluidbox-outer").length&&(b("body").append(a._currentOptions.templates.outer),b("#fluidbox-outer").html(a._currentOptions.templates.inner));0===b("#fluidbox-overlay").length&&
b("body").append(a._currentOptions.templates.overlay);0===b("#fluidbox-loading").length&&b("body").append(a._currentOptions.templates.loading);0===b("#fluidbox-title").length&&!1!==a._currentOptions.positions.title&&b("#fluidbox-"+a._currentOptions.positions.title).append(a._currentOptions.templates.title);!1!==a._currentOptions.positions.buttons.close&&0===b("#fluidbox-btn-close").length&&b("#fluidbox-"+a._currentOptions.positions.buttons.close).append(a._currentOptions.templates.buttons.close);
1<a._currentCollection.length&&(!1!==a._currentOptions.positions.buttons.next&&0===b("#fluidbox-btn-next").length&&b("#fluidbox-"+a._currentOptions.positions.buttons.next).append(a._currentOptions.templates.buttons.next),!1!==a._currentOptions.positions.buttons.prev&&0===b("#fluidbox-btn-prev").length&&b("#fluidbox-"+a._currentOptions.positions.buttons.prev).append(a._currentOptions.templates.buttons.prev));a._overlay=b("#fluidbox-overlay");a._outer=b("#fluidbox-outer");a._inner=b("#fluidbox-inner");
a._loading=b("#fluidbox-loading");a._title=b("#fluidbox-title");a._isTouch&&a._outer.addClass("touch");b(a._instance).triggerHandler("fluidboxAfterCreate")},_unbindEvents:function(){b(document).unbind("keydown.fluidbox");b(window).unbind("resize.fluidbox");a._overlay.unbind("click");b("#fluidbox-btn-close").unbind("click");b("#fluidbox-btn-next").unbind("click");b("#fluidbox-btn-prev").unbind("click")},_bindEvents:function(){b(a._instance).triggerHandler("fluidboxBeforeBind");b(document).bind("keydown.fluidbox",
function(c){c.ctrlKey||(c.altKey||c.shiftKey||c.metaKey)||(-1<b.inArray(c.which,a._currentOptions.keys.close)?(a.close(),c.preventDefault()):1<a._currentCollection.length&&-1<b.inArray(c.which,a._currentOptions.keys.next)?(a.next(),c.preventDefault()):1<a._currentCollection.length&&-1<b.inArray(c.which,a._currentOptions.keys.prev)&&(a.prev(),c.preventDefault()))});a._overlay.click(function(){a.close()});b("#fluidbox-btn-close").click(function(){a.close()});b("#fluidbox-btn-next").click(function(){a.next()});
b("#fluidbox-btn-prev").click(function(){a.prev()});a._isTouch||a._outer.dblclick(function(){a._isDraggable=!0===a._isDraggable?!1:!0;a.resize()});a._currentOptions.resize&&b(window).bind("resize.fluidbox",a.resize);!1!==a._isAnimated&&a._bindAnimationEvents();a._isTouch&&a._bindTouchEvents();b(a._instance).triggerHandler("fluidboxAfterBind")},_bindAnimationEvents:function(){!1!==a._isAnimated&&b(document).bind(a._transEndEventNames,function(c){b(c.target).removeClass(a._animClasses).removeClass("opening closing");
b(c.target).is(a._loading)&&(a._isLoading||a._loading.hide());b(c.target).is(a._overlay)&&a._isClosing&&(a._overlay.remove(),a._inner.remove(),a._outer.remove(),a._loading.remove(),b("body").css({overflow:""}),b(document).unbind(a._transEndEventNames));b(c.target).is(a._outer)&&a._isClosing&&a._outer.remove();b(c.target).hasClass("fluidbox-outer-ghost")&&b(c.target).remove()})},_bindTouchEvents:function(){a._outer.hammer({drag:!0,transform:!0,swipe:!0,tap:!0,hold:!1});a._outer.bind("dragstart",function(b){b.preventDefault();
a._outer.data("currentX",parseInt(a._outer.css("left"),10));a._outer.data("currentY",parseInt(a._outer.css("top"),10))});a._outer.bind("drag",function(b){a._isDraggable&&(b.preventDefault(),a._outer.css({left:Math.round(a._outer.data("currentX")+b.gesture.deltaX),top:Math.round(a._outer.data("currentY")+b.gesture.deltaY)}))});a._outer.bind("dragend",function(b){b.preventDefault();a._outer.removeData("currentX");a._outer.removeData("currentY")});a._outer.bind("doubletap",function(b){a._isDraggable=
!a._isDraggable;a.resize()});a._outer.bind("transformstart",function(b){a._outer.data("currentX",parseInt(a._outer.css("left"),10));a._outer.data("currentY",parseInt(a._outer.css("top"),10));a._outer.data("currentWidth",a._outer.width());a._outer.data("currentHeight",a._outer.height());a._isDraggable=!0});a._outer.bind("transform",function(b){var d=Math.round(a._outer.data("currentWidth")*b.gesture.scale),e=Math.round(a._outer.data("currentHeight")*b.gesture.scale);a._outer.css({width:d,left:Math.round(a._outer.data("currentX")+
(a._outer.data("currentWidth")-d)/2+b.gesture.deltaX),top:Math.round(a._outer.data("currentY")+(a._outer.data("currentHeight")-e)/2+b.gesture.deltaY)})});a._outer.bind("transformend",function(b){a._outer.removeData("currentWidth");a._outer.removeData("currentX");a._outer.removeData("currentY")});a._outer.bind("swipe",function(b){a._isDraggable||("left"===b.gesture.direction?a.next():"right"===b.gesture.direction&&a.prev())})},_showLoading:function(b){a._isLoading=b;a._loading.removeClass(a._animClasses);
a._isLoading?(!1!==a._isAnimated&&a._loading.removeClass(a._animClasses).addClass("animated fadeIn"),a._loading.show()):!1!==a._isAnimated?a._loading.removeClass(a._animClasses).addClass("animated fadeOut"):a._loading.hide()},_preloadCollection:function(){for(var c=0,d,c=0;c<a._currentCollection.length;c+=1)d=new Image,d.src=b(a._currentCollection[c]).attr("href")},open:function(c,d,e){a._currentCollection=c;a._instance=e;a._currentOptions=b.extend(!0,{},a.defaults,d);a._currentIndex=a._currentOptions.index;
a._isOpening=!0;a._isClosing=!1;a._hasHammer="function"===typeof Hammer;a._hasModernizr="function"===typeof Modernizr;a._isTouch=a._currentOptions.touch;a._isTouch&&(!a._hasHammer||a._hasModernizr&&!Modernizr.touch)&&(a._isTouch=!1,console.log("Touch support not detected or not available (missing hammer.js?), touch disabled."));a._isAnimated=a._currentOptions.animated;a._isAnimated&&(a._hasModernizr&&!Modernizr.csstransitions)&&(a._isAnimated=!1,console.log("CSS3 transition support not detected or not available, animations disabled."));
a._createOverlay();b(a._instance).triggerHandler("fluidboxBeforeOpen");!1!==a._isAnimated&&a._overlay.removeClass(a._animClasses).addClass("animated fadeIn opening");a._overlay.show();c=document.body.scrollLeft+document.documentElement.scrollLeft;d=document.body.scrollTop+document.documentElement.scrollTop;b("body").css({overflow:"hidden"});window.scrollTo(c,d);a.show(a._currentIndex,"open");a._bindEvents();a._currentOptions.preload&&a._preloadCollection();b(a._instance).triggerHandler("fluidboxAfterOpen")},
close:function(){b(a._instance).triggerHandler("fluidboxBeforeClose");a._isClosing=!0;a._isDraggable=!1;!1!==a._isAnimated?a._overlay.removeClass(a._animClasses).addClass("animated fadeOut closing"):a._overlay.hide();!1===a._isLoading?!1!==a._isAnimated?a._outer.removeClass(a._animClasses).addClass("animated "+b(a._outer).data("animation").close+" closing"):a._outer.hide():(a._showLoading(!1),a._outer.hide());a._unbindEvents();b(a._instance).triggerHandler("fluidboxAfterClose")},next:function(){1>=
a._currentCollection.length||(a._isDraggable||a._isLoading)||a.show(a._currentIndex===a._currentCollection.length-1?0:a._currentIndex+1,"next")},prev:function(){1>=a._currentCollection.length||(a._isDraggable||a._isLoading)||a.show(0===a._currentIndex?a._currentCollection.length-1:a._currentIndex-1,"prev")},show:function(c,d){if(!a._isLoading){if("undefined"===c||0>c||c>a._currentCollection.length)c=0;d||(d=c>a._currentIndex||c<a._currentIndex?c>a._currentIndex?"next":"prev":"open");a._currentIndex=
c;var e=a._currentCollection[c],g=new Image,f=b(a._outer).clone(!0);"open"===d||a._isLoading||(b(a._instance).triggerHandler("fluidboxBeforeHide"),b(a._outer).removeClass(a._animClasses),b(a._outer).hide(),b(f).removeAttr("id"),b(f).addClass("fluidbox-outer-ghost"),b(f).removeClass(a._animClasses),b("body").append(f),!1!==a._isAnimated?("prev"===d?b(f).addClass("animated "+b(f).data("animation").prev.out):"next"===d&&b(f).addClass("animated "+b(f).data("animation").next.out),b(f).show()):b(f).remove(),
b(a._instance).triggerHandler("fluidboxAfterHide"));a._title.replaceWith(a._currentOptions.templates.title);a._title=b("#fluidbox-title");a._inner.children("img").first().remove();g.onload=function(){var f={index:c,target:e,direction:d,image:this,title:b(e).attr("title"),animation:b.extend(!0,{},a._currentOptions.animations,b(e).data("animation"))};b(a._instance).triggerHandler("fluidboxBeforeShow",f);b(a._outer).data("animation",b.extend(!0,{},a.defaults.animations,f.animation));a._inner.append('<img src="'+
b(e).attr("href")+'" width="'+this.width+'" height="'+this.height+'" />');a._title.append(f.title);!1!==a._isAnimated&&("open"===d?a._outer.removeClass(a._animClasses).addClass("animated "+b(a._outer).data("animation").open+" opening"):"prev"===d?a._outer.removeClass(a._animClasses).addClass("animated "+b(a._outer).data("animation").prev["in"]):"next"===d&&a._outer.removeClass(a._animClasses).addClass("animated "+b(a._outer).data("animation").next["in"]));a._outer.show();a._showLoading(!1);a._currentOptions.resize&&
a.resize();b(a._instance).triggerHandler("fluidboxAfterShow",f)};g.src=b(e).attr("href");a._showLoading(!0)}},resize:function(){var c=0,d=0,e=0,g=0,f=0,h=0,e=d=c=0,c=b(a._inner).children("img").attr("width"),d=b(a._inner).children("img").attr("height"),e=b(window).width(),g=b(window).height(),f=e-a._currentOptions.padding,h=g-a._currentOptions.padding;(c>f||d>h)&&!a._isDraggable?(e=Math.min(f/c,h/d),c=Math.round(c*e),d=Math.round(d*e),a._outer.css({width:c,left:Math.round(a._currentOptions.padding/
2+(f-c)/2),top:Math.round(a._currentOptions.padding/2+(h-d)/2)})):a._outer.css({width:c,left:Math.round((e-c)/2),top:Math.round((g-d)/2)})}};b.fn.fluidbox=function(a){var d=b(this);a=a||{};this.click(function(e){e.preventDefault();e=[this];b(this).attr("rel")?(e=d.filter('[rel="'+b(this).attr("rel")+'"]'),a.index=e.index(this)):a.index=0;b.fluidbox.open(e,a,b(d))});return b(this)}})})(jQuery);
